/*!
 * chartjs-plugin-streaming
 * http://github.com/nagix/chartjs-plugin-streaming/
 * Version: 1.0.0
 *
 * Copyright 2017 Akihiko Kusanagi
 * Released under the MIT license
 * https://github.com/nagix/chartjs-plugin-streaming/blob/master/LICENSE.md
 */
!function e(t,r,a){function i(n,s){if(!r[n]){if(!t[n]){var l="function"==typeof require&&require;if(!s&&l)return l(n,!0);if(o)return o(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[n]={exports:{}};t[n][0].call(u.exports,function(e){var r=t[n][1][e];return i(r||e)},u,u.exports,e,t,r,a)}return r[n].exports}for(var o="function"==typeof require&&require,n=0;n<a.length;n++)i(a[n]);return i}({1:[function(e,t,r){},{}],2:[function(e,t,r){"use strict";function a(e){for(var t=Object.keys(x),r=t.indexOf(e);r<t.length;){var a=t[++r];if("week"!==a&&"quarter"!==a)return a}return null}function i(e,t){return t?m(e).add(1,t).startOf(t):e}function o(e,t,r){var o=[];if(e.maxTicks){var n=e.stepSize,s=void 0!==e.min?e.min:r.min,l=a(e.unit),c=i(s,l).valueOf()-s,u=x[e.unit].size*n,f=c%u,p=s;f&&l&&!e.isoWeekday?(p+=f-u,o.push(p)):o.push(s);for(var d=m(p),v=e.max||r.max;d.add(n,e.unit).valueOf()<v;)o.push(d.valueOf());o.push(d.valueOf())}return o}function n(e,t){var r=t.length;if(!e.options.plugins.streaming||0===r)return e.chartArea;var a=v.clone(e.chartArea),i=t[r-1]._model;return e.horizontalScroll&&(a.right=i.x),e.verticalScroll&&(a.bottom=i.y),a}function s(e,t,r){e.forEach(function(e){for(var a=e.data,i=0;i<a.length&&!m(t(a[i])).isSameOrAfter(r);++i);a.splice(0,i)})}function l(e){var t=e.chart.options.plugins.streaming;t&&"time"===e.options.type&&(e.options.time.max+=t.refresh)}function c(e){var t=e.chart.options.plugins.streaming;if(t&&"time"===e.options.type){var r=e.options.time;r.max-=t.refresh,e.min=r.min,e.max=r.max}}function u(e,t){var r=e.chart.ctx,a=v.clone(e.chartArea),i=0,o=0,n=(Date.now()-e.lastUpdate)/t.duration;e.horizontalScroll&&(a.top=0,a.bottom=e.height,i=-(a.right-a.left)*n),e.verticalScroll&&(a.left=0,a.right=e.width,o=-(a.bottom-a.top)*n),d.canvasHelpers.clipArea(r,a),r.translate(i,o)}function f(e){d.canvasHelpers.unclipArea(e.ctx)}function p(e){var t=e.options;if(t.display){var r=e.ctx,a=t.gridLines;if(a.drawBorder){r.lineWidth=v.getValueAtIndexOrDefault(a.lineWidth,0),r.strokeStyle=v.getValueAtIndexOrDefault(a.color,0);var i=e.right,o=e.getPixelForTick(e.ticks.length-1),n=e.bottom,s=e.getPixelForTick(e.ticks.length-1),l=v.aliasPixel(r.lineWidth);e.isHorizontal()?(n=s="top"===t.position?e.bottom:e.top,n+=l,s+=l):(i=o="left"===t.position?e.right:e.left,i+=l,o+=l),r.beginPath(),r.moveTo(i,n),r.lineTo(o,s),r.stroke()}}}var m=e("moment");m="function"==typeof m?m:window.moment;var d=e("chart.js"),v=(d="function"==typeof d?d:window.Chart).helpers,h=d.plugins;d.defaults.global.plugins.streaming={duration:1e4,refresh:1e3,delay:0,onRefresh:null};var x={millisecond:{size:1,steps:[1,2,5,10,20,50,100,250,500]},second:{size:1e3,steps:[1,2,5,10,30]},minute:{size:6e4,steps:[1,2,5,10,30]},hour:{size:36e5,steps:[1,2,3,6,12]},day:{size:864e5,steps:[1,2,5]},week:{size:6048e5,maxStep:4},month:{size:2628e6,maxStep:3},quarter:{size:7884e6,maxStep:4},year:{size:3154e7,maxStep:!1}};d.Ticks.generators.time=function(e,t){var r,a,i=e.isoWeekday;return"week"===e.unit&&!1!==i?(r=m(t.min).startOf("isoWeek").isoWeekday(i).valueOf(),a=m(t.max).startOf("isoWeek").isoWeekday(i),t.max-a>0&&a.add(1,"week"),a=a.valueOf()):(r=m(t.min).startOf(e.unit).valueOf(),a=m(t.max).startOf(e.unit),t.max-a>0&&a.add(1,e.unit),a=a.valueOf()),o(e,t,{min:r,max:a})},d.prototype.draw=function(e){var t=this;t.clear(),void 0!==e&&null!==e||(e=1),t.transition(e),!1!==h.notify(t,"beforeDraw",[e])&&(t.drawBoxes(),t.drawDatasets(e),t.tooltip.draw(),h.notify(t,"afterDraw",[e]))},d.prototype.drawBoxes=function(){var e=this,t=e.chartArea;v.each(e.boxes,function(r){!0===h.notify(e,"beforeBoxDraw",[r,t])&&(r.draw(e.chartArea),h.notify(e,"afterBoxDraw",[r,t]))}),e.scale&&!0===h.notify(e,"beforeBoxDraw",[e.scale,t])&&(e.scale.draw(),h.notify(e,"afterBoxDraw",[e.scale,t]))},d.controllers.line.prototype.draw=function(){var e=this,t=e.chart,r=t.options.plugins.streaming,a=e.getMeta(),i=a.data||[],o=n(t,i),s=i.length,l=0;for(r||d.canvasHelpers.clipArea(t.ctx,t.chartArea),v.getValueOrDefault(e.getDataset().showLine,t.options.showLines)&&a.dataset.draw(),r||d.canvasHelpers.unclipArea(t.ctx);l<s;++l)i[l].draw(o)};var w={id:"streaming",afterInit:function(e,t){var r=e.options.scales,a=r.xAxes[0],i=r.yAxes[0];a.beforeBuildTicks=i.beforeBuildTicks=l,a.afterBuildTicks=i.afterBuildTicks=c;var o=Date.now()+t.refresh,n=function(){var r=Date.now();r>=o&&(o=r+t.refresh+(r-o)%t.refresh,t.onRefresh&&t.onRefresh(e),e.update()),(e.horizontalScroll||e.verticalScroll)&&e.draw(),v.requestAnimFrame.call(window,n)};v.requestAnimFrame.call(window,n)},beforeUpdate:function(e,t){var r=e.options,a=r.scales,i=a.xAxes[0],o=a.yAxes[0],n=e.data.datasets;i.ticks.maxRotation=!1,r.elements.line.capBezierPoints=!1,r.animation.duration=0,e.horizontalScroll="time"===i.type,e.verticalScroll="time"===o.type;var l=m().subtract(t.delay,"ms"),c=l.clone().subtract(t.duration,"ms"),u=c.clone().subtract(2*t.refresh,"ms");e.horizontalScroll&&(i.time.min=c,i.time.max=l,s(n,function(e){return e.x},u)),e.verticalScroll&&(o.time.min=c,o.time.max=l,s(n,function(e){return e.y},u)),e.lastUpdate=Date.now()},afterRender:function(e){var t=e.tooltip;t._active=t._active||[],t.update(!0)},beforeDraw:function(e,t,r){return u(e,r),!0},afterDraw:function(e){f(e);var t=e.lastMouseMoveEvent;t&&e.canvas.dispatchEvent(t.native)},beforeBoxDraw:function(e,t){return"time"!==t.options.type&&f(e),!0},afterBoxDraw:function(e,t,r,a){"time"!==t.options.type?u(e,a):p(t)},beforeEvent:function(e,t,r){if("mousemove"===t.type){e.lastMouseMoveEvent=t;var a=e.chartArea;if(t.x>=a.left&&t.x<a.right&&t.y>=a.top&&t.y<a.bottom){var i=(Date.now()-e.lastUpdate)/r.duration;e.horizontalScroll&&(t.x+=(a.right-a.left)*i),e.verticalScroll&&(t.y+=(a.bottom-a.top)*i)}}else"mouseout"===t.type&&delete e.lastMouseMoveEvent;return!0}};t.exports=w,h.register(w)},{"chart.js":1,moment:1}]},{},[2]);